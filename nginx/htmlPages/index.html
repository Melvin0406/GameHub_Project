<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Inicio - Plataforma de Streaming</title>
  <style>
    /* Estilos básicos de la página de inicio */
    body {
      margin: 0; 
      padding: 0;
      font-family: Arial, sans-serif;
      background-color: #f2f2f2;
    }
    header {
      background-color: #007BFF;
      color: #fff;
      padding: 1rem;
      text-align: center;
    }
    nav a {
      color: #fff;
      margin: 0 1rem;
      text-decoration: none;
    }
    main {
      text-align: center;
      padding: 2rem;
    }
    .boton {
      display: inline-block;
      margin: 1rem;
      padding: 0.8rem 1.2rem;
      background-color: #007BFF;
      color: #fff;
      text-decoration: none;
      border-radius: 5px;
    }
    .boton:hover {
      background-color: #0056b3;
    }
  </style>
</head>
<body>
  <!-- 
    Página principal (inicio). Muestra si hay un usuario "logueado" (falso).
    Usa localStorage para guardar "username" y "themeColor".
  -->
  <header>
    <h1>Plataforma de Streaming - Inicio</h1>
    <nav>
      <!-- Enlaces a otras secciones -->
      <a href="index.html">Inicio</a>
      <a href="games.html">Juegos</a>
      <a href="startStream.html">Iniciar Stream</a>
      <a href="messages.html">Mensajes Privados</a>
      <a href="email.html">Enviar Correo</a>
      <a href="config.html">Configuración</a>
    </nav>
  </header>

  <main>
    <h2>Bienvenido a la Plataforma de S</h2>
    <p id="userInfo"></p>
    <!-- Botones de atajo -->
    <a class="boton" href="games.html">Ver Juegos Disponibles</a>
    <a class="boton" href="startStream.html">Iniciar un Stream</a>
    <a class="boton" id="streamLink">Ver Stream en Vivo</a>
    <br>
    <!-- Botón de Login / Logout dinámico -->
    <a class="boton" href="login.html" id="loginBtn">Login</a>
  </main>

  <script>
    // Detecta el dominio actual y cambia el enlace al stream
    const streamLink = document.getElementById('streamLink');
    if (window.location.hostname.includes('cetys')) {
        streamLink.href = 'http://servidor-stream.cetys.local';
    } else {
        streamLink.href = 'http://servidor-stream.casa.local';
    }
    
    // --- Lógica de Autenticación Actualizada ---
    const authToken = localStorage.getItem('authToken');
    const userInfo = document.getElementById('userInfo'); // Asumo que tienes un <p id="userInfo"></p> o similar
    const loginBtn = document.getElementById('loginBtn'); // Asumo que tienes <a id="loginBtn">Login</a>
    // Podrías querer un botón de Configuración o Perfil que solo aparezca si está logueado
    // const configBtn = document.getElementById('configBtn'); // Si tienes <a id="configBtn">Configuración</a>

    function updateNavBasedOnAuth() {
        if (authToken) {
            // Para obtener el nombre de usuario, podrías decodificar el token (requiere una librería como jwt-decode en el frontend)
            // o, mejor aún, tener un endpoint en el backend /api/auth/me que devuelva los datos del usuario.
            // Por ahora, un mensaje genérico:
            // O si guardaste el usuario en login: const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            // if (currentUser) {
            //    userInfo.textContent = `Bienvenido, ${currentUser.username}!`;
            // } else {
            userInfo.textContent = '¡Bienvenido! Sesión iniciada.'; // Mensaje simple
            // }
            
            loginBtn.textContent = 'Cerrar Sesión';
            loginBtn.href = '#logout'; // Evita ir a login.html directamente

            loginBtn.onclick = () => { // Usamos onclick para poder removerlo si es necesario o simplemente sobreescribir
                localStorage.removeItem('authToken');
                // localStorage.removeItem('currentUser'); // Si guardaste datos del usuario
                // Opcional: Informar al backend sobre el logout si tienes lógica de sesión en servidor
                window.location.reload(); // Recarga para reflejar el estado de logout
            };

            // if (configBtn) configBtn.style.display = 'inline-block'; // Muestra el botón de config

        } else {
            userInfo.textContent = 'No has iniciado sesión.';
            loginBtn.textContent = 'Login';
            loginBtn.href = 'login.html';
            loginBtn.onclick = null; // Remueve cualquier handler de logout previo
            // if (configBtn) configBtn.style.display = 'none'; // Oculta el botón de config
        }
    }

    updateNavBasedOnAuth(); // Llama a la función al cargar la página

    // También aplicamos el color de tema guardado, si existe
    const storedColor = localStorage.getItem('themeColor');
    if (storedColor) {
        document.body.style.backgroundColor = storedColor;
    }
  </script>
</body>
</html>